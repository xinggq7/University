var object;
//空气质量
var hqzhl;
var huichengnongdu;
$(function () {
	var time = (new Date()).getTime();
	
    $(document).ready(function () {
    	
        Highcharts.setOptions({
            global: {
                useUTC: false
            }
        });

        $('#container').highcharts({
        	plotOptions: {
                series: {
                    marker: {
                        enabled: false, /*数据点是否显示*/
                       // radius: 0,  /*数据点大小px*/
                        //fillColor:'#ff3300'         /*数据点颜色*/
                    },
                   
                    
                }
            },
        	
            chart: {
                type: 'spline',
                animation: Highcharts.svg, // don't animate in old IE
                marginRight: 10,
                events: {
                    load: function () {

                        // set up the updating of the chart each second
                        var series = this.series[0];
                        var series1 = this.series[1];
                        var series2 = this.series[2];
                        var series3 = this.series[3];
                        var series4 = this.series[4];
                        var series5 = this.series[5];
                        //历史记录数组
                        var array=[10,10,10,10,10,10,10,10,10,0];
                        var array1=[10,10,10,10,10,110,0,0,0,0];
                        //总和
                        var sum=0;
                        var sum1=0;
                        var i=10;
                        setInterval(function () {
                            var x = (new Date()).getTime();// current time
                                //y = Math.random();
                            if(object!=null){
	                            series.addPoint([x, parseFloat(object.wendu)], true, false);
	                            series1.addPoint([x, parseFloat(object.shidu)], true, false);
	                            series2.addPoint([x, parseFloat(object.qiya)], true, false);
	                            
	                            array1[i]=parseFloat(object.huichengnongdu);
	                            sum1=sum1+array1[i]-array1[i-10];
	                            huichengnongdu=sum1/10;
	                            huichengnongdu=huichengnongdu.toFixed(2);
	                            huichengnongdu=parseFloat(huichengnongdu);
	                            series3.addPoint([x, huichengnongdu], true, false);
	                            series4.addPoint([x, parseFloat(object.haiba)], true, false);
	                            /**
	                            if(array.length>0){
	                            	//加入数组
	                            	array[i]=parseInt(object.kongqizhiliang);
	                            	sum+=array[i++];
	                            	hqzhl=parseInt(sum/array.length);
	                            	series5.addPoint([x,hqzhl], true, false);
	                            }
	                            */
	                            array[i]=parseFloat(object.kongqizhiliang);
	                            sum=sum+array[i]-array[i-10];
	                            i++;
	                            hqzhl=parseInt(sum/10);
	                           
	                            series5.addPoint([x,hqzhl], true, false);
                            }  
                            //alert(object.qiya);
                        }, 500);
                    }
                }
            },
            
            title: {
                text: ''
            },
            
            xAxis: {
                type: 'datetime',
                tickPixelInterval: 150
            },
            
            yAxis: {
                title: {
                    text: 'Value'
                },
                plotLines: [{
                    value: 0,
                    width: 1,
                    color: '#808080'
                }]
            },
            
            tooltip: {
                formatter: function () {
                    return '<b>' + this.series.name + '</b><br/>' +
                        Highcharts.dateFormat('%Y-%m-%d %H:%M:%S', this.x) + '<br/>' +
                        Highcharts.numberFormat(this.y, 2);
                }
            },
            legend: {
            	itemStyle : {	'fontSize' : '18px'	},
                align: 'right',
               
                //verticalAlign: 'middle',
                borderWidth: 0
            },
           
            exporting: {
                enabled: false
            },
            series: [{
                name: '温度',
                data: (function () {
                    // generate an array of random data
                    var data = [];
                    return data;
                }())
                
            },
            {
                name: '湿度',
                data: (function () {
                    // generate an array of random data
                    var data = [];
                    return data;
                }())
            },{
                name: '气压',
                data: (function () {
                    // generate an array of random data
                    var data = [];
                    return data;
                }())
            },
            {
                name: '灰尘浓度',
                data: (function () {
                    // generate an array of random data
                    var data = [];
                    return data;
                }())
            },
            {
                name: '海拔',
                data: (function () {
                    // generate an array of random data
                    var data = [];
                    return data;
                }())
            },
            {
                name: '空气质量',
                data: (function () {
                    // generate an array of random data
                    var data = [];
                    return data;
                }())
            }
            ]
            
        });
        
        
    });
});
	 var timer = setInterval( ajax , 500);
	    
	    var clear = function(){
	        clearInterval(timer);
	    }
		var xmlHTTP;
		function ajax(){
			var url="AdminAction";
			if(window.XMLHttpRequest){//ie7以上，火狐，谷歌，苹果
				xmlHTTP = new XMLHttpRequest();//获取浏览器内置的这个对象，这个对象的作用就将http请求发送到服务器
			}else{
				xmlHTTP = ActiveXObject("Microsoft.XMLHTTP");
			}
			xmlHTTP.onreadystatechange=callBackFun;//设置回调方法
			xmlHTTP.open("POST",url,true);
			xmlHTTP.setRequestHeader("Content-type","application/x-www-form-urlencoded;charset=UTF-8");//设置请求的头部信息，只有当状态码为1时，才可以在open
			xmlHTTP.send();
		}
		function callBackFun(){
			if(xmlHTTP.readyState==4&&xmlHTTP.status==200){
			var s = xmlHTTP.responseText;
			object = eval("(" + s + ")");//将传送过来的json字符串包装成一个对象，注意要加上两边的圆括号
			document.getElementById("wendu").innerText=object.wendu+"℃";
			document.getElementById("shidu").innerText=object.shidu+"%";
			document.getElementById("huichengnongdu").innerText=huichengnongdu+"mg/m³";
			document.getElementById("kongqizhiliang").innerText=hqzhl+"";
			document.getElementById("haiba").innerText=object.haiba+"m";
			document.getElementById("qiya").innerText=object.qiya+"KPa";
			
	}			
}
